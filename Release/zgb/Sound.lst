                              1 ;--------------------------------------------------------
                              2 ; File Created by SDCC : free open source ANSI-C Compiler
                              3 ; Version 4.0.0 #11528 (MINGW32)
                              4 ;--------------------------------------------------------
                              5 	.module Sound
                              6 	.optsdcc -mgbz80
                              7 	
                              8 ;--------------------------------------------------------
                              9 ; Public variables in this module
                             10 ;--------------------------------------------------------
                             11 	.globl _gbt_enable_channels
                             12 	.globl _FX_ADDRESS
                             13 	.globl _FX_REG_SIZES
                             14 	.globl _PlayFx
                             15 ;--------------------------------------------------------
                             16 ; special function registers
                             17 ;--------------------------------------------------------
                             18 ;--------------------------------------------------------
                             19 ; ram data
                             20 ;--------------------------------------------------------
                             21 	.area _DATA
                             22 ;--------------------------------------------------------
                             23 ; absolute external ram data
                             24 ;--------------------------------------------------------
                             25 	.area _DABS (ABS)
                             26 ;--------------------------------------------------------
                             27 ; global & static initialisations
                             28 ;--------------------------------------------------------
                             29 	.area _HOME
                             30 	.area _GSINIT
                             31 	.area _GSFINAL
                             32 	.area _GSINIT
                             33 ;--------------------------------------------------------
                             34 ; Home
                             35 ;--------------------------------------------------------
                             36 	.area _HOME
                             37 	.area _HOME
                             38 ;--------------------------------------------------------
                             39 ; code
                             40 ;--------------------------------------------------------
                             41 	.area _CODE
                             42 ;C:/GB/ZGB/common/src/Sound.c:11: void PlayFx(SOUND_CHANNEL channel, UINT8 mute_frames, ...) {
                             43 ;	---------------------------------
                             44 ; Function PlayFx
                             45 ; ---------------------------------
   0000                      46 _PlayFx::
   0000 E8 F9                47 	add	sp, #-7
                             48 ;C:/GB/ZGB/common/src/Sound.c:13: UINT8* reg = (UINT8*)FX_ADDRESS[channel];
   0002 F8 09                49 	ldhl	sp,	#9
   0004 4E                   50 	ld	c, (hl)
   0005 06 00                51 	ld	b, #0x00
   0007 CB 21                52 	sla	c
   0009 CB 10                53 	rl	b
   000B 21r8Fr00             54 	ld	hl, #_FX_ADDRESS
   000E 09                   55 	add	hl, bc
   000F 4D                   56 	ld	c,l
   0010 44                   57 	ld	b,h
   0011 4E                   58 	ld	c, (hl)
   0012 23                   59 	inc	hl
   0013 46                   60 	ld	b, (hl)
   0014 F8 04                61 	ldhl	sp,	#4
   0016 71                   62 	ld	(hl), c
   0017 23                   63 	inc	hl
   0018 70                   64 	ld	(hl), b
                             65 ;C:/GB/ZGB/common/src/Sound.c:16: va_start(list, mute_frames);
   0019 F8 0A                66 	ldhl	sp,	#10
   001B 4D                   67 	ld	c, l
   001C 44                   68 	ld	b, h
   001D 03                   69 	inc	bc
   001E 33                   70 	inc	sp
   001F 33                   71 	inc	sp
   0020 C5                   72 	push	bc
                             73 ;C:/GB/ZGB/common/src/Sound.c:17: for(i = 0; i < FX_REG_SIZES[channel]; ++i, ++reg) {
   0021 11r8Ar00             74 	ld	de, #_FX_REG_SIZES
   0024 F8 09                75 	ldhl	sp,	#9
   0026 6E                   76 	ld	l, (hl)
   0027 26 00                77 	ld	h, #0x00
   0029 19                   78 	add	hl, de
   002A 7D                   79 	ld	a, l
   002B 54                   80 	ld	d, h
   002C F8 02                81 	ldhl	sp,	#2
   002E 22                   82 	ld	(hl+), a
   002F 72                   83 	ld	(hl), d
   0030 AF                   84 	xor	a, a
   0031 F8 06                85 	ldhl	sp,	#6
   0033 77                   86 	ld	(hl), a
   0034                      87 00105$:
   0034 F8 02                88 	ldhl	sp,#(3 - 1)
   0036 5E                   89 	ld	e, (hl)
   0037 23                   90 	inc	hl
   0038 56                   91 	ld	d, (hl)
   0039 1A                   92 	ld	a,(de)
   003A 4F                   93 	ld	c, a
   003B F8 06                94 	ldhl	sp,	#6
   003D 7E                   95 	ld	a, (hl)
   003E 91                   96 	sub	a, c
   003F 30 1F                97 	jr	NC,00101$
                             98 ;C:/GB/ZGB/common/src/Sound.c:18: *reg = va_arg(list, INT16);
   0041 C1                   99 	pop	bc
   0042 C5                  100 	push	bc
   0043 03                  101 	inc	bc
   0044 03                  102 	inc	bc
   0045 33                  103 	inc	sp
   0046 33                  104 	inc	sp
   0047 C5                  105 	push	bc
   0048 0B                  106 	dec	bc
   0049 0B                  107 	dec	bc
   004A 0A                  108 	ld	a, (bc)
   004B 4F                  109 	ld	c, a
   004C 2B                  110 	dec	hl
   004D 2B                  111 	dec	hl
   004E 2A                  112 	ld	a, (hl+)
   004F 66                  113 	ld	h, (hl)
   0050 6F                  114 	ld	l, a
   0051 71                  115 	ld	(hl), c
                            116 ;C:/GB/ZGB/common/src/Sound.c:17: for(i = 0; i < FX_REG_SIZES[channel]; ++i, ++reg) {
   0052 F8 06               117 	ldhl	sp,	#6
   0054 34                  118 	inc	(hl)
   0055 2B                  119 	dec	hl
   0056 2B                  120 	dec	hl
   0057 34                  121 	inc	(hl)
   0058 C2r34r00            122 	jp	NZ,00105$
   005B 23                  123 	inc	hl
   005C 34                  124 	inc	(hl)
   005D C3r34r00            125 	jp	00105$
   0060                     126 00101$:
                            127 ;C:/GB/ZGB/common/src/Sound.c:22: if(channel != CHANNEL_5) {
   0060 F8 09               128 	ldhl	sp,	#9
   0062 7E                  129 	ld	a, (hl)
   0063 D6 04               130 	sub	a, #0x04
   0065 28 17               131 	jr	Z,00103$
                            132 ;C:/GB/ZGB/common/src/Sound.c:23: gbt_enable_channels(~(0xF & (1 << channel)));
   0067 F8 09               133 	ldhl	sp,	#9
   0069 4E                  134 	ld	c, (hl)
   006A 06 01               135 	ld	b, #0x01
   006C 0C                  136 	inc	c
   006D 18 02               137 	jr	00130$
   006F                     138 00129$:
   006F CB 20               139 	sla	b
   0071                     140 00130$:
   0071 0D                  141 	dec	c
   0072 20 FB               142 	jr	NZ,00129$
   0074 78                  143 	ld	a, b
   0075 E6 0F               144 	and	a, #0x0f
   0077 2F                  145 	cpl
   0078 F5                  146 	push	af
   0079 33                  147 	inc	sp
   007A CDr00r00            148 	call	_gbt_enable_channels
   007D 33                  149 	inc	sp
   007E                     150 00103$:
                            151 ;C:/GB/ZGB/common/src/Sound.c:26: music_mute_frames = mute_frames;
   007E E5                  152 	push	hl
   007F F8 0C               153 	ldhl	sp,	#12
   0081 7E                  154 	ld	a, (hl)
   0082 21r00r00            155 	ld	hl, #_music_mute_frames
   0085 77                  156 	ld	(hl), a
   0086 E1                  157 	pop	hl
                            158 ;C:/GB/ZGB/common/src/Sound.c:27: }
   0087 E8 07               159 	add	sp, #7
   0089 C9                  160 	ret
   008A                     161 _FX_REG_SIZES:
   008A 05                  162 	.db #0x05	; 5
   008B 04                  163 	.db #0x04	; 4
   008C 05                  164 	.db #0x05	; 5
   008D 04                  165 	.db #0x04	; 4
   008E 03                  166 	.db #0x03	; 3
   008F                     167 _FX_ADDRESS:
   008F 10 FF               168 	.dw #0xff10
   0091 16 FF               169 	.dw #0xff16
   0093 1A FF               170 	.dw #0xff1a
   0095 20 FF               171 	.dw #0xff20
   0097 24 FF               172 	.dw #0xff24
                            173 	.area _CODE
                            174 	.area _CABS (ABS)
