                              1 ;--------------------------------------------------------
                              2 ; File Created by SDCC : free open source ANSI-C Compiler
                              3 ; Version 4.0.0 #11528 (MINGW32)
                              4 ;--------------------------------------------------------
                              5 	.module SpriteManager
                              6 	.optsdcc -mgbz80
                              7 	
                              8 ;--------------------------------------------------------
                              9 ; Public variables in this module
                             10 ;--------------------------------------------------------
                             11 	.globl _SetBank
                             12 	.globl _PopBank
                             13 	.globl _PushBank
                             14 	.globl _RefreshScroll
                             15 	.globl _DrawSprite
                             16 	.globl _InitSprite
                             17 	.globl _ClearOAMs
                             18 	.globl _SwapOAMs
                             19 	.globl _LoadSprite
                             20 	.globl _VectorRemovePos
                             21 	.globl _VectorAdd
                             22 	.globl _THIS
                             23 	.globl _THIS_IDX
                             24 	.globl _cachedSprite
                             25 	.globl _sprite_manager_removal_check
                             26 	.globl _sprite_manager_updatables
                             27 	.globl _sprite_manager_sprites_pool
                             28 	.globl _sprite_manager_sprites_poolSTACK
                             29 	.globl _sprite_manager_sprites
                             30 	.globl _sprite_manager_sprites_mem
                             31 	.globl _SpriteManagerReset
                             32 	.globl _SpriteManagerLoad
                             33 	.globl _SpriteManagerAdd
                             34 	.globl _SpriteManagerRemove
                             35 	.globl _SpriteManagerRemoveSprite
                             36 	.globl _SpriteManagerFlushRemove
                             37 	.globl _SpriteManagerUpdate
                             38 ;--------------------------------------------------------
                             39 ; special function registers
                             40 ;--------------------------------------------------------
                             41 ;--------------------------------------------------------
                             42 ; ram data
                             43 ;--------------------------------------------------------
                             44 	.area _DATA
   0000                      45 _sprite_manager_sprites_mem::
   0000                      46 	.ds 660
   0294                      47 _sprite_manager_sprites::
   0294                      48 	.ds 40
   02BC                      49 _sprite_manager_sprites_poolSTACK::
   02BC                      50 	.ds 20
   02D0                      51 _sprite_manager_sprites_pool::
   02D0                      52 	.ds 2
   02D2                      53 _sprite_manager_updatables::
   02D2                      54 	.ds 21
   02E7                      55 _sprite_manager_removal_check::
   02E7                      56 	.ds 1
   02E8                      57 _cachedSprite::
   02E8                      58 	.ds 2
   02EA                      59 _THIS_IDX::
   02EA                      60 	.ds 1
   02EB                      61 _THIS::
   02EB                      62 	.ds 2
                             63 ;--------------------------------------------------------
                             64 ; absolute external ram data
                             65 ;--------------------------------------------------------
                             66 	.area _DABS (ABS)
                             67 ;--------------------------------------------------------
                             68 ; global & static initialisations
                             69 ;--------------------------------------------------------
                             70 	.area _HOME
                             71 	.area _GSINIT
                             72 	.area _GSFINAL
                             73 	.area _GSINIT
                             74 ;C:/GB/ZGB/common/src/SpriteManager.c:11: DECLARE_STACK(sprite_manager_sprites_pool, N_SPRITE_MANAGER_SPRITES);
   0000 21rD0r02             75 	ld	hl, #_sprite_manager_sprites_pool
   0003 36rBB                76 	ld	(hl), #<((_sprite_manager_sprites_poolSTACK - 0x0001))
   0005 23                   77 	inc	hl
   0006 36s02                78 	ld	(hl), #>((_sprite_manager_sprites_poolSTACK - 0x0001))
                             79 ;C:/GB/ZGB/common/src/SpriteManager.c:14: DECLARE_VECTOR(sprite_manager_updatables, N_SPRITE_MANAGER_SPRITES);
   0008 21rD2r02             80 	ld	hl, #_sprite_manager_updatables
   000B 36 00                81 	ld	(hl), #0x00
                             82 ;--------------------------------------------------------
                             83 ; Home
                             84 ;--------------------------------------------------------
                             85 	.area _HOME
                             86 	.area _HOME
                             87 ;--------------------------------------------------------
                             88 ; code
                             89 ;--------------------------------------------------------
                             90 	.area _CODE
                             91 ;C:/GB/ZGB/common/src/SpriteManager.c:18: void SpriteManagerReset() {
                             92 ;	---------------------------------
                             93 ; Function SpriteManagerReset
                             94 ; ---------------------------------
   0000                      95 _SpriteManagerReset::
   0000 E8 FD                96 	add	sp, #-3
                             97 ;C:/GB/ZGB/common/src/SpriteManager.c:22: for(i = 0u; i != sprite_manager_updatables[0]; ++ i) {
   0002 AF                   98 	xor	a, a
   0003 F8 02                99 	ldhl	sp,	#2
   0005 77                  100 	ld	(hl), a
   0006                     101 00104$:
   0006 21rD2r02            102 	ld	hl, #_sprite_manager_updatables + 0
   0009 4E                  103 	ld	c, (hl)
   000A F8 02               104 	ldhl	sp,	#2
   000C 7E                  105 	ld	a, (hl)
   000D 91                  106 	sub	a, c
   000E CAr7Ar00            107 	jp	Z,00101$
                            108 ;C:/GB/ZGB/common/src/SpriteManager.c:23: THIS = sprite_manager_sprites[sprite_manager_updatables[i + 1]];
   0011 F8 02               109 	ldhl	sp,	#2
   0013 7E                  110 	ld	a, (hl)
   0014 3C                  111 	inc	a
   0015 4F                  112 	ld	c, a
   0016 17                  113 	rla
   0017 9F                  114 	sbc	a, a
   0018 47                  115 	ld	b, a
   0019 21rD2r02            116 	ld	hl, #_sprite_manager_updatables
   001C 09                  117 	add	hl, bc
   001D 4D                  118 	ld	c,l
   001E 7C                  119 	ld	a,h
   001F 4E                  120 	ld	c, (hl)
   0020 06 00               121 	ld	b, #0x00
   0022 CB 21               122 	sla	c
   0024 CB 10               123 	rl	b
   0026 21r94r02            124 	ld	hl, #_sprite_manager_sprites
   0029 09                  125 	add	hl, bc
   002A 4D                  126 	ld	c, l
   002B 44                  127 	ld	b, h
   002C 59                  128 	ld	e, c
   002D 50                  129 	ld	d, b
   002E 1A                  130 	ld	a,(de)
   002F 21rEBr02            131 	ld	hl, #_THIS
   0032 22                  132 	ld	(hl+), a
   0033 13                  133 	inc	de
   0034 1A                  134 	ld	a, (de)
                            135 ;C:/GB/ZGB/common/src/SpriteManager.c:24: PUSH_BANK(spriteBanks[THIS->type]);
   0035 32                  136 	ld	(hl-), a
   0036 4E                  137 	ld	c, (hl)
   0037 23                  138 	inc	hl
   0038 46                  139 	ld	b, (hl)
   0039 21 11 00            140 	ld	hl, #0x0011
   003C 09                  141 	add	hl, bc
   003D 4D                  142 	ld	c, l
   003E 44                  143 	ld	b, h
   003F 0A                  144 	ld	a, (bc)
   0040 C6r00               145 	add	a, #<(_spriteBanks)
   0042 4F                  146 	ld	c, a
   0043 3E 00               147 	ld	a, #0x00
   0045 CEs00               148 	adc	a, #>(_spriteBanks)
   0047 47                  149 	ld	b, a
   0048 0A                  150 	ld	a, (bc)
   0049 F5                  151 	push	af
   004A 33                  152 	inc	sp
   004B CDr00r00            153 	call	_PushBank
   004E 33                  154 	inc	sp
                            155 ;C:/GB/ZGB/common/src/SpriteManager.c:25: spriteDestroyFuncs[THIS->type]();
   004F 21rECr02            156 	ld	hl, #_THIS + 1
   0052 2B                  157 	dec	hl
   0053 4E                  158 	ld	c, (hl)
   0054 23                  159 	inc	hl
   0055 46                  160 	ld	b, (hl)
   0056 21 11 00            161 	ld	hl, #0x0011
   0059 09                  162 	add	hl, bc
   005A 4D                  163 	ld	c,l
   005B 7C                  164 	ld	a,h
   005C 4E                  165 	ld	c, (hl)
   005D 06 00               166 	ld	b, #0x00
   005F CB 21               167 	sla	c
   0061 CB 10               168 	rl	b
   0063 21r00r00            169 	ld	hl, #_spriteDestroyFuncs
   0066 09                  170 	add	hl, bc
   0067 4D                  171 	ld	c,l
   0068 44                  172 	ld	b,h
   0069 4E                  173 	ld	c, (hl)
   006A 23                  174 	inc	hl
   006B 46                  175 	ld	b, (hl)
   006C 69                  176 	ld	l, c
   006D 60                  177 	ld	h, b
   006E CDr00r00            178 	call	___sdcc_call_hl
                            179 ;C:/GB/ZGB/common/src/SpriteManager.c:26: POP_BANK;
   0071 CDr00r00            180 	call	_PopBank
                            181 ;C:/GB/ZGB/common/src/SpriteManager.c:22: for(i = 0u; i != sprite_manager_updatables[0]; ++ i) {
   0074 F8 02               182 	ldhl	sp,	#2
   0076 34                  183 	inc	(hl)
   0077 C3r06r00            184 	jp	00104$
   007A                     185 00101$:
                            186 ;C:/GB/ZGB/common/src/SpriteManager.c:30: StackClear(sprite_manager_sprites_pool);
   007A 21rD0r02            187 	ld	hl, #_sprite_manager_sprites_pool
   007D 36rBB               188 	ld	(hl), #<((_sprite_manager_sprites_poolSTACK - 0x0001))
   007F 23                  189 	inc	hl
   0080 36s02               190 	ld	(hl), #>((_sprite_manager_sprites_poolSTACK - 0x0001))
                            191 ;C:/GB/ZGB/common/src/SpriteManager.c:31: for(i = 0; i != N_SPRITE_MANAGER_SPRITES; ++i) {
   0082 AF                  192 	xor	a, a
   0083 F8 02               193 	ldhl	sp,	#2
   0085 77                  194 	ld	(hl), a
   0086                     195 00106$:
                            196 ;C:/GB/ZGB/common/src/SpriteManager.c:32: sprite_manager_sprites[i] = (struct Sprite*)&sprite_manager_sprites_mem[sizeof(struct Sprite) * (UINT16)i];
   0086 F8 02               197 	ldhl	sp,	#2
   0088 4E                  198 	ld	c, (hl)
   0089 06 00               199 	ld	b, #0x00
   008B CB 21               200 	sla	c
   008D CB 10               201 	rl	b
   008F 21r94r02            202 	ld	hl, #_sprite_manager_sprites
   0092 09                  203 	add	hl, bc
   0093 33                  204 	inc	sp
   0094 33                  205 	inc	sp
   0095 E5                  206 	push	hl
   0096 F8 02               207 	ldhl	sp,	#2
   0098 4E                  208 	ld	c, (hl)
   0099 06 00               209 	ld	b, #0x00
   009B 69                  210 	ld	l, c
   009C 60                  211 	ld	h, b
   009D 29                  212 	add	hl, hl
   009E 29                  213 	add	hl, hl
   009F 29                  214 	add	hl, hl
   00A0 29                  215 	add	hl, hl
   00A1 29                  216 	add	hl, hl
   00A2 09                  217 	add	hl, bc
   00A3 4D                  218 	ld	c, l
   00A4 44                  219 	ld	b, h
   00A5 21r00r00            220 	ld	hl, #_sprite_manager_sprites_mem
   00A8 09                  221 	add	hl, bc
   00A9 4D                  222 	ld	c, l
   00AA 7C                  223 	ld	a, h
   00AB 47                  224 	ld	b, a
   00AC E1                  225 	pop	hl
   00AD E5                  226 	push	hl
   00AE 71                  227 	ld	(hl), c
   00AF 23                  228 	inc	hl
   00B0 70                  229 	ld	(hl), b
                            230 ;C:/GB/ZGB/common/src/SpriteManager.c:33: StackPush(sprite_manager_sprites_pool, i);		
   00B1 21rD0r02            231 	ld	hl, #_sprite_manager_sprites_pool
   00B4 34                  232 	inc	(hl)
   00B5 20 02               233 	jr	NZ,00139$
   00B7 23                  234 	inc	hl
   00B8 34                  235 	inc	(hl)
   00B9                     236 00139$:
   00B9 21rD1r02            237 	ld	hl, #_sprite_manager_sprites_pool + 1
   00BC 2B                  238 	dec	hl
   00BD 4E                  239 	ld	c, (hl)
   00BE 23                  240 	inc	hl
   00BF 46                  241 	ld	b, (hl)
   00C0 F8 02               242 	ldhl	sp,	#2
   00C2 7E                  243 	ld	a, (hl)
   00C3 02                  244 	ld	(bc), a
                            245 ;C:/GB/ZGB/common/src/SpriteManager.c:31: for(i = 0; i != N_SPRITE_MANAGER_SPRITES; ++i) {
   00C4 34                  246 	inc	(hl)
   00C5 7E                  247 	ld	a, (hl)
   00C6 D6 14               248 	sub	a, #0x14
   00C8 C2r86r00            249 	jp	NZ,00106$
                            250 ;C:/GB/ZGB/common/src/SpriteManager.c:35: ClearOAMs();
   00CB CDr00r00            251 	call	_ClearOAMs
                            252 ;C:/GB/ZGB/common/src/SpriteManager.c:38: sprite_manager_updatables[0] = 0;
   00CE 21rD2r02            253 	ld	hl, #_sprite_manager_updatables
   00D1 36 00               254 	ld	(hl), #0x00
                            255 ;C:/GB/ZGB/common/src/SpriteManager.c:39: sprite_manager_removal_check = 0;
   00D3 21rE7r02            256 	ld	hl, #_sprite_manager_removal_check
   00D6 36 00               257 	ld	(hl), #0x00
                            258 ;C:/GB/ZGB/common/src/SpriteManager.c:40: }
   00D8 E8 03               259 	add	sp, #3
   00DA C9                  260 	ret
                            261 ;C:/GB/ZGB/common/src/SpriteManager.c:42: void SpriteManagerLoad(UINT8 sprite_type) {
                            262 ;	---------------------------------
                            263 ; Function SpriteManagerLoad
                            264 ; ---------------------------------
   00DB                     265 _SpriteManagerLoad::
   00DB E8 FE               266 	add	sp, #-2
                            267 ;C:/GB/ZGB/common/src/SpriteManager.c:43: PUSH_BANK(spriteDataBanks[sprite_type])
   00DD 01r00r00            268 	ld	bc, #_spriteDataBanks+0
   00E0 F8 04               269 	ldhl	sp,	#4
   00E2 6E                  270 	ld	l, (hl)
   00E3 26 00               271 	ld	h, #0x00
   00E5 09                  272 	add	hl, bc
   00E6 4D                  273 	ld	c, l
   00E7 44                  274 	ld	b, h
   00E8 0A                  275 	ld	a, (bc)
   00E9 F5                  276 	push	af
   00EA 33                  277 	inc	sp
   00EB CDr00r00            278 	call	_PushBank
   00EE 33                  279 	inc	sp
                            280 ;C:/GB/ZGB/common/src/SpriteManager.c:44: spriteIdxs[sprite_type] = LoadSprite(spriteDatas[sprite_type]);
   00EF 11r00r00            281 	ld	de, #_spriteIdxs
   00F2 F8 04               282 	ldhl	sp,	#4
   00F4 6E                  283 	ld	l, (hl)
   00F5 26 00               284 	ld	h, #0x00
   00F7 19                  285 	add	hl, de
   00F8 33                  286 	inc	sp
   00F9 33                  287 	inc	sp
   00FA E5                  288 	push	hl
   00FB F8 04               289 	ldhl	sp,	#4
   00FD 4E                  290 	ld	c, (hl)
   00FE 06 00               291 	ld	b, #0x00
   0100 CB 21               292 	sla	c
   0102 CB 10               293 	rl	b
   0104 21r00r00            294 	ld	hl, #_spriteDatas
   0107 09                  295 	add	hl, bc
   0108 4D                  296 	ld	c,l
   0109 44                  297 	ld	b,h
   010A 4E                  298 	ld	c, (hl)
   010B 23                  299 	inc	hl
   010C 46                  300 	ld	b, (hl)
   010D C5                  301 	push	bc
   010E CDr00r00            302 	call	_LoadSprite
   0111 E8 02               303 	add	sp, #2
   0113 4B                  304 	ld	c, e
   0114 E1                  305 	pop	hl
   0115 E5                  306 	push	hl
   0116 71                  307 	ld	(hl), c
                            308 ;C:/GB/ZGB/common/src/SpriteManager.c:45: POP_BANK
   0117 CDr00r00            309 	call	_PopBank
                            310 ;C:/GB/ZGB/common/src/SpriteManager.c:46: }
   011A E8 02               311 	add	sp, #2
   011C C9                  312 	ret
                            313 ;C:/GB/ZGB/common/src/SpriteManager.c:49: struct Sprite* SpriteManagerAdd(UINT8 sprite_type, UINT16 x, UINT16 y) {
                            314 ;	---------------------------------
                            315 ; Function SpriteManagerAdd
                            316 ; ---------------------------------
   011D                     317 _SpriteManagerAdd::
   011D E8 F9               318 	add	sp, #-7
                            319 ;C:/GB/ZGB/common/src/SpriteManager.c:54: sprite_idx = StackPop(sprite_manager_sprites_pool);
   011F 21rD1r02            320 	ld	hl, #_sprite_manager_sprites_pool + 1
   0122 2B                  321 	dec	hl
   0123 4E                  322 	ld	c, (hl)
   0124 23                  323 	inc	hl
   0125 46                  324 	ld	b, (hl)
   0126 0A                  325 	ld	a, (bc)
   0127 F8 06               326 	ldhl	sp,	#6
   0129 77                  327 	ld	(hl), a
   012A 21rD1r02            328 	ld	hl, #_sprite_manager_sprites_pool + 1
   012D 2B                  329 	dec	hl
   012E 5E                  330 	ld	e, (hl)
   012F 23                  331 	inc	hl
   0130 56                  332 	ld	d, (hl)
   0131 1B                  333 	dec	de
   0132 2B                  334 	dec	hl
   0133 73                  335 	ld	(hl), e
   0134 23                  336 	inc	hl
   0135 72                  337 	ld	(hl), d
                            338 ;C:/GB/ZGB/common/src/SpriteManager.c:55: sprite = sprite_manager_sprites[sprite_idx];
   0136 F8 06               339 	ldhl	sp,	#6
   0138 4E                  340 	ld	c, (hl)
   0139 06 00               341 	ld	b, #0x00
   013B CB 21               342 	sla	c
   013D CB 10               343 	rl	b
   013F 21r94r02            344 	ld	hl, #_sprite_manager_sprites
   0142 09                  345 	add	hl, bc
   0143 4D                  346 	ld	c, l
   0144 44                  347 	ld	b, h
   0145 59                  348 	ld	e, c
   0146 50                  349 	ld	d, b
   0147 1A                  350 	ld	a,(de)
   0148 F8 00               351 	ldhl	sp,	#0
   014A 22                  352 	ld	(hl+), a
   014B 13                  353 	inc	de
   014C 1A                  354 	ld	a, (de)
   014D 77                  355 	ld	(hl), a
                            356 ;C:/GB/ZGB/common/src/SpriteManager.c:56: sprite->type = sprite_type;
   014E D1                  357 	pop	de
   014F D5                  358 	push	de
   0150 21 11 00            359 	ld	hl, #0x0011
   0153 19                  360 	add	hl, de
   0154 7D                  361 	ld	a, l
   0155 54                  362 	ld	d, h
   0156 F8 02               363 	ldhl	sp,	#2
   0158 22                  364 	ld	(hl+), a
   0159 72                  365 	ld	(hl), d
   015A C1                  366 	pop	bc
   015B D1                  367 	pop	de
   015C D5                  368 	push	de
   015D C5                  369 	push	bc
   015E F8 09               370 	ldhl	sp,	#9
   0160 7E                  371 	ld	a, (hl)
   0161 12                  372 	ld	(de), a
                            373 ;C:/GB/ZGB/common/src/SpriteManager.c:57: sprite->marked_for_removal = 0;
   0162 D1                  374 	pop	de
   0163 D5                  375 	push	de
   0164 21 12 00            376 	ld	hl, #0x0012
   0167 19                  377 	add	hl, de
   0168 4D                  378 	ld	c, l
   0169 44                  379 	ld	b, h
   016A AF                  380 	xor	a, a
   016B 02                  381 	ld	(bc), a
                            382 ;C:/GB/ZGB/common/src/SpriteManager.c:58: sprite->lim_x = 32u;
   016C D1                  383 	pop	de
   016D D5                  384 	push	de
   016E 21 13 00            385 	ld	hl, #0x0013
   0171 19                  386 	add	hl, de
   0172 4D                  387 	ld	c, l
   0173 44                  388 	ld	b, h
   0174 3E 20               389 	ld	a, #0x20
   0176 02                  390 	ld	(bc), a
   0177 03                  391 	inc	bc
   0178 3E 00               392 	ld	a, #0x00
   017A 02                  393 	ld	(bc), a
                            394 ;C:/GB/ZGB/common/src/SpriteManager.c:59: sprite->lim_y = 32u;
   017B D1                  395 	pop	de
   017C D5                  396 	push	de
   017D 21 15 00            397 	ld	hl, #0x0015
   0180 19                  398 	add	hl, de
   0181 4D                  399 	ld	c, l
   0182 44                  400 	ld	b, h
   0183 3E 20               401 	ld	a, #0x20
   0185 02                  402 	ld	(bc), a
   0186 03                  403 	inc	bc
   0187 3E 00               404 	ld	a, #0x00
   0189 02                  405 	ld	(bc), a
                            406 ;C:/GB/ZGB/common/src/SpriteManager.c:60: sprite->flags = 0;
   018A D1                  407 	pop	de
   018B D5                  408 	push	de
   018C 21 0C 00            409 	ld	hl, #0x000c
   018F 19                  410 	add	hl, de
   0190 4D                  411 	ld	c, l
   0191 44                  412 	ld	b, h
   0192 AF                  413 	xor	a, a
   0193 02                  414 	ld	(bc), a
                            415 ;C:/GB/ZGB/common/src/SpriteManager.c:62: VectorAdd(sprite_manager_updatables, sprite_idx);
   0194 F8 06               416 	ldhl	sp,	#6
   0196 7E                  417 	ld	a, (hl)
   0197 F5                  418 	push	af
   0198 33                  419 	inc	sp
   0199 21rD2r02            420 	ld	hl, #_sprite_manager_updatables
   019C E5                  421 	push	hl
   019D CDr00r00            422 	call	_VectorAdd
   01A0 E8 03               423 	add	sp, #3
                            424 ;C:/GB/ZGB/common/src/SpriteManager.c:64: PUSH_BANK(spriteDataBanks[sprite->type]);
   01A2 F8 02               425 	ldhl	sp,#(3 - 1)
   01A4 5E                  426 	ld	e, (hl)
   01A5 23                  427 	inc	hl
   01A6 56                  428 	ld	d, (hl)
   01A7 1A                  429 	ld	a,(de)
   01A8 C6r00               430 	add	a, #<(_spriteDataBanks)
   01AA 4F                  431 	ld	c, a
   01AB 3E 00               432 	ld	a, #0x00
   01AD CEs00               433 	adc	a, #>(_spriteDataBanks)
   01AF 47                  434 	ld	b, a
   01B0 0A                  435 	ld	a, (bc)
   01B1 F5                  436 	push	af
   01B2 33                  437 	inc	sp
   01B3 CDr00r00            438 	call	_PushBank
   01B6 33                  439 	inc	sp
                            440 ;C:/GB/ZGB/common/src/SpriteManager.c:65: InitSprite(sprite, spriteDatas[sprite_type]->height == 8 ? 0 : spriteDatas[sprite_type]->width >> 3, spriteIdxs[sprite_type]);
   01B7 01r00r00            441 	ld	bc, #_spriteIdxs+0
   01BA F8 09               442 	ldhl	sp,	#9
   01BC 6E                  443 	ld	l, (hl)
   01BD 26 00               444 	ld	h, #0x00
   01BF 09                  445 	add	hl, bc
   01C0 4D                  446 	ld	c, l
   01C1 44                  447 	ld	b, h
   01C2 0A                  448 	ld	a, (bc)
   01C3 F8 04               449 	ldhl	sp,	#4
   01C5 77                  450 	ld	(hl), a
   01C6 F8 09               451 	ldhl	sp,	#9
   01C8 4E                  452 	ld	c, (hl)
   01C9 06 00               453 	ld	b, #0x00
   01CB CB 21               454 	sla	c
   01CD CB 10               455 	rl	b
   01CF 21r00r00            456 	ld	hl, #_spriteDatas
   01D2 09                  457 	add	hl, bc
   01D3 4D                  458 	ld	c,l
   01D4 44                  459 	ld	b,h
   01D5 4E                  460 	ld	c, (hl)
   01D6 23                  461 	inc	hl
   01D7 46                  462 	ld	b, (hl)
   01D8 21 01 00            463 	ld	hl, #0x0001
   01DB 09                  464 	add	hl, bc
   01DC 7D                  465 	ld	a, l
   01DD 54                  466 	ld	d, h
   01DE F8 05               467 	ldhl	sp,	#5
   01E0 22                  468 	ld	(hl+), a
   01E1 72                  469 	ld	(hl), d
   01E2 2B                  470 	dec	hl
   01E3 5E                  471 	ld	e, (hl)
   01E4 23                  472 	inc	hl
   01E5 56                  473 	ld	d, (hl)
   01E6 1A                  474 	ld	a,(de)
   01E7 D6 08               475 	sub	a, #0x08
   01E9 20 06               476 	jr	NZ,00103$
   01EB 16 00               477 	ld	d, #0x00
   01ED 06 00               478 	ld	b, #0x00
   01EF 18 09               479 	jr	00104$
   01F1                     480 00103$:
   01F1 0A                  481 	ld	a, (bc)
   01F2 CB 37               482 	swap	a
   01F4 07                  483 	rlca
   01F5 E6 1F               484 	and	a, #0x1f
   01F7 57                  485 	ld	d, a
   01F8 06 00               486 	ld	b, #0x00
   01FA                     487 00104$:
   01FA F8 04               488 	ldhl	sp,	#4
   01FC 7E                  489 	ld	a, (hl)
   01FD F5                  490 	push	af
   01FE 33                  491 	inc	sp
   01FF D5                  492 	push	de
   0200 33                  493 	inc	sp
   0201 C1                  494 	pop	bc
   0202 E1                  495 	pop	hl
   0203 E5                  496 	push	hl
   0204 C5                  497 	push	bc
   0205 E5                  498 	push	hl
   0206 CDr00r00            499 	call	_InitSprite
   0209 E8 04               500 	add	sp, #4
                            501 ;C:/GB/ZGB/common/src/SpriteManager.c:66: POP_BANK;
   020B CDr00r00            502 	call	_PopBank
                            503 ;C:/GB/ZGB/common/src/SpriteManager.c:67: sprite->x = x;
   020E D1                  504 	pop	de
   020F D5                  505 	push	de
   0210 21 08 00            506 	ld	hl, #0x0008
   0213 19                  507 	add	hl, de
   0214 4D                  508 	ld	c, l
   0215 44                  509 	ld	b, h
   0216 F8 0A               510 	ldhl	sp,	#10
   0218 2A                  511 	ld	a, (hl+)
   0219 02                  512 	ld	(bc), a
   021A 03                  513 	inc	bc
   021B 7E                  514 	ld	a, (hl)
   021C 02                  515 	ld	(bc), a
                            516 ;C:/GB/ZGB/common/src/SpriteManager.c:68: sprite->y = y;
   021D D1                  517 	pop	de
   021E D5                  518 	push	de
   021F 21 0A 00            519 	ld	hl, #0x000a
   0222 19                  520 	add	hl, de
   0223 4D                  521 	ld	c, l
   0224 44                  522 	ld	b, h
   0225 F8 0C               523 	ldhl	sp,	#12
   0227 2A                  524 	ld	a, (hl+)
   0228 02                  525 	ld	(bc), a
   0229 03                  526 	inc	bc
   022A 7E                  527 	ld	a, (hl)
   022B 02                  528 	ld	(bc), a
                            529 ;C:/GB/ZGB/common/src/SpriteManager.c:71: cachedSprite = THIS;
   022C 21rEBr02            530 	ld	hl, #_THIS
   022F 2A                  531 	ld	a, (hl+)
   0230 5E                  532 	ld	e, (hl)
   0231 21rE8r02            533 	ld	hl, #_cachedSprite
   0234 22                  534 	ld	(hl+), a
   0235 73                  535 	ld	(hl), e
                            536 ;C:/GB/ZGB/common/src/SpriteManager.c:72: spriteIdxTmp = THIS_IDX;
   0236 E5                  537 	push	hl
   0237 21rEAr02            538 	ld	hl, #_THIS_IDX
   023A 7E                  539 	ld	a, (hl)
   023B F8 08               540 	ldhl	sp,	#8
   023D 77                  541 	ld	(hl), a
   023E E1                  542 	pop	hl
                            543 ;C:/GB/ZGB/common/src/SpriteManager.c:73: THIS = sprite;
   023F F8 00               544 	ldhl	sp,	#0
   0241 2A                  545 	ld	a, (hl+)
   0242 5E                  546 	ld	e, (hl)
   0243 21rEBr02            547 	ld	hl, #_THIS
   0246 22                  548 	ld	(hl+), a
   0247 73                  549 	ld	(hl), e
                            550 ;C:/GB/ZGB/common/src/SpriteManager.c:74: THIS_IDX = sprite_manager_updatables[0] - 1;
   0248 FArD2r02            551 	ld	a, (#_sprite_manager_updatables + 0)
   024B C6 FF               552 	add	a, #0xff
   024D 21rEAr02            553 	ld	hl, #_THIS_IDX
   0250 77                  554 	ld	(hl), a
                            555 ;C:/GB/ZGB/common/src/SpriteManager.c:75: PUSH_BANK(spriteBanks[sprite->type]);
   0251 F8 02               556 	ldhl	sp,#(3 - 1)
   0253 5E                  557 	ld	e, (hl)
   0254 23                  558 	inc	hl
   0255 56                  559 	ld	d, (hl)
   0256 1A                  560 	ld	a,(de)
   0257 C6r00               561 	add	a, #<(_spriteBanks)
   0259 4F                  562 	ld	c, a
   025A 3E 00               563 	ld	a, #0x00
   025C CEs00               564 	adc	a, #>(_spriteBanks)
   025E 47                  565 	ld	b, a
   025F 0A                  566 	ld	a, (bc)
   0260 F5                  567 	push	af
   0261 33                  568 	inc	sp
   0262 CDr00r00            569 	call	_PushBank
   0265 33                  570 	inc	sp
                            571 ;C:/GB/ZGB/common/src/SpriteManager.c:76: spriteStartFuncs[sprite->type]();
   0266 F8 02               572 	ldhl	sp,#(3 - 1)
   0268 5E                  573 	ld	e, (hl)
   0269 23                  574 	inc	hl
   026A 56                  575 	ld	d, (hl)
   026B 1A                  576 	ld	a,(de)
   026C 4F                  577 	ld	c, a
   026D 06 00               578 	ld	b, #0x00
   026F CB 21               579 	sla	c
   0271 CB 10               580 	rl	b
   0273 21r00r00            581 	ld	hl, #_spriteStartFuncs
   0276 09                  582 	add	hl, bc
   0277 4D                  583 	ld	c,l
   0278 44                  584 	ld	b,h
   0279 4E                  585 	ld	c, (hl)
   027A 23                  586 	inc	hl
   027B 46                  587 	ld	b, (hl)
   027C 69                  588 	ld	l, c
   027D 60                  589 	ld	h, b
   027E CDr00r00            590 	call	___sdcc_call_hl
                            591 ;C:/GB/ZGB/common/src/SpriteManager.c:77: POP_BANK;
   0281 CDr00r00            592 	call	_PopBank
                            593 ;C:/GB/ZGB/common/src/SpriteManager.c:79: THIS = cachedSprite;
   0284 21rE8r02            594 	ld	hl, #_cachedSprite
   0287 2A                  595 	ld	a, (hl+)
   0288 5E                  596 	ld	e, (hl)
   0289 21rEBr02            597 	ld	hl, #_THIS
   028C 22                  598 	ld	(hl+), a
   028D 73                  599 	ld	(hl), e
                            600 ;C:/GB/ZGB/common/src/SpriteManager.c:80: THIS_IDX = spriteIdxTmp;
   028E E5                  601 	push	hl
   028F F8 08               602 	ldhl	sp,	#8
   0291 7E                  603 	ld	a, (hl)
   0292 21rEAr02            604 	ld	hl, #_THIS_IDX
   0295 77                  605 	ld	(hl), a
   0296 E1                  606 	pop	hl
                            607 ;C:/GB/ZGB/common/src/SpriteManager.c:81: return sprite;
   0297 D1                  608 	pop	de
   0298 D5                  609 	push	de
                            610 ;C:/GB/ZGB/common/src/SpriteManager.c:82: }
   0299 E8 07               611 	add	sp, #7
   029B C9                  612 	ret
                            613 ;C:/GB/ZGB/common/src/SpriteManager.c:84: void SpriteManagerRemove(int idx) {
                            614 ;	---------------------------------
                            615 ; Function SpriteManagerRemove
                            616 ; ---------------------------------
   029C                     617 _SpriteManagerRemove::
                            618 ;C:/GB/ZGB/common/src/SpriteManager.c:85: sprite_manager_removal_check = 1;
   029C 21rE7r02            619 	ld	hl, #_sprite_manager_removal_check
   029F 36 01               620 	ld	(hl), #0x01
                            621 ;C:/GB/ZGB/common/src/SpriteManager.c:86: sprite_manager_sprites[sprite_manager_updatables[idx + 1]]->marked_for_removal = 1;
   02A1 F8 02               622 	ldhl	sp,	#2
   02A3 7E                  623 	ld	a, (hl)
   02A4 3C                  624 	inc	a
   02A5 4F                  625 	ld	c, a
   02A6 17                  626 	rla
   02A7 9F                  627 	sbc	a, a
   02A8 47                  628 	ld	b, a
   02A9 21rD2r02            629 	ld	hl, #_sprite_manager_updatables
   02AC 09                  630 	add	hl, bc
   02AD 4D                  631 	ld	c, l
   02AE 44                  632 	ld	b, h
   02AF 0A                  633 	ld	a, (bc)
   02B0 4F                  634 	ld	c, a
   02B1 06 00               635 	ld	b, #0x00
   02B3 CB 21               636 	sla	c
   02B5 CB 10               637 	rl	b
   02B7 21r94r02            638 	ld	hl, #_sprite_manager_sprites
   02BA 09                  639 	add	hl, bc
   02BB 4D                  640 	ld	c,l
   02BC 44                  641 	ld	b,h
   02BD 4E                  642 	ld	c, (hl)
   02BE 23                  643 	inc	hl
   02BF 46                  644 	ld	b, (hl)
   02C0 21 12 00            645 	ld	hl, #0x0012
   02C3 09                  646 	add	hl, bc
   02C4 4D                  647 	ld	c,l
   02C5 7C                  648 	ld	a,h
   02C6 36 01               649 	ld	(hl), #0x01
                            650 ;C:/GB/ZGB/common/src/SpriteManager.c:87: }
   02C8 C9                  651 	ret
                            652 ;C:/GB/ZGB/common/src/SpriteManager.c:89: void SpriteManagerRemoveSprite(struct Sprite* sprite) {
                            653 ;	---------------------------------
                            654 ; Function SpriteManagerRemoveSprite
                            655 ; ---------------------------------
   02C9                     656 _SpriteManagerRemoveSprite::
   02C9 E8 FE               657 	add	sp, #-2
                            658 ;C:/GB/ZGB/common/src/SpriteManager.c:92: for(i = 0u; i != sprite_manager_updatables[0]; ++i) {
   02CB AF                  659 	xor	a, a
   02CC F8 00               660 	ldhl	sp,	#0
   02CE 77                  661 	ld	(hl), a
   02CF AF                  662 	xor	a, a
   02D0 23                  663 	inc	hl
   02D1 77                  664 	ld	(hl), a
   02D2                     665 00105$:
   02D2 21rD2r02            666 	ld	hl, #_sprite_manager_updatables + 0
   02D5 4E                  667 	ld	c, (hl)
   02D6 F8 01               668 	ldhl	sp,	#1
   02D8 7E                  669 	ld	a, (hl)
   02D9 91                  670 	sub	a, c
   02DA CAr1Br03            671 	jp	Z,00107$
                            672 ;C:/GB/ZGB/common/src/SpriteManager.c:93: s = sprite_manager_sprites[sprite_manager_updatables[i + 1]];
   02DD F8 01               673 	ldhl	sp,	#1
   02DF 7E                  674 	ld	a, (hl)
   02E0 3C                  675 	inc	a
   02E1 4F                  676 	ld	c, a
   02E2 17                  677 	rla
   02E3 9F                  678 	sbc	a, a
   02E4 47                  679 	ld	b, a
   02E5 21rD2r02            680 	ld	hl, #_sprite_manager_updatables
   02E8 09                  681 	add	hl, bc
   02E9 4D                  682 	ld	c,l
   02EA 7C                  683 	ld	a,h
   02EB 4E                  684 	ld	c, (hl)
   02EC 06 00               685 	ld	b, #0x00
   02EE CB 21               686 	sla	c
   02F0 CB 10               687 	rl	b
   02F2 21r94r02            688 	ld	hl, #_sprite_manager_sprites
   02F5 09                  689 	add	hl, bc
   02F6 4D                  690 	ld	c,l
   02F7 44                  691 	ld	b,h
   02F8 4E                  692 	ld	c, (hl)
   02F9 23                  693 	inc	hl
   02FA 46                  694 	ld	b, (hl)
                            695 ;C:/GB/ZGB/common/src/SpriteManager.c:94: if(s == sprite) {
   02FB F8 04               696 	ldhl	sp,	#4
   02FD 7E                  697 	ld	a, (hl)
   02FE 91                  698 	sub	a, c
   02FF 20 12               699 	jr	NZ,00106$
   0301 23                  700 	inc	hl
   0302 7E                  701 	ld	a, (hl)
   0303 90                  702 	sub	a, b
   0304 20 0D               703 	jr	NZ,00106$
                            704 ;C:/GB/ZGB/common/src/SpriteManager.c:95: SpriteManagerRemove(i);
   0306 F8 00               705 	ldhl	sp,	#0
   0308 4E                  706 	ld	c, (hl)
   0309 06 00               707 	ld	b, #0x00
   030B C5                  708 	push	bc
   030C CDr9Cr02            709 	call	_SpriteManagerRemove
   030F E8 02               710 	add	sp, #2
                            711 ;C:/GB/ZGB/common/src/SpriteManager.c:96: break;
   0311 18 08               712 	jr	00107$
   0313                     713 00106$:
                            714 ;C:/GB/ZGB/common/src/SpriteManager.c:92: for(i = 0u; i != sprite_manager_updatables[0]; ++i) {
   0313 F8 01               715 	ldhl	sp,	#1
   0315 34                  716 	inc	(hl)
   0316 3A                  717 	ld	a, (hl-)
   0317 77                  718 	ld	(hl), a
   0318 C3rD2r02            719 	jp	00105$
   031B                     720 00107$:
                            721 ;C:/GB/ZGB/common/src/SpriteManager.c:99: }
   031B E8 02               722 	add	sp, #2
   031D C9                  723 	ret
                            724 ;C:/GB/ZGB/common/src/SpriteManager.c:101: void SpriteManagerFlushRemove() {
                            725 ;	---------------------------------
                            726 ; Function SpriteManagerFlushRemove
                            727 ; ---------------------------------
   031E                     728 _SpriteManagerFlushRemove::
   031E E8 FE               729 	add	sp, #-2
                            730 ;C:/GB/ZGB/common/src/SpriteManager.c:103: for(THIS_IDX = sprite_manager_updatables[0] - 1u; (UINT8)(THIS_IDX + 1u) != 0u; THIS_IDX --) {
   0320 FArD2r02            731 	ld	a, (#_sprite_manager_updatables + 0)
   0323 C6 FF               732 	add	a, #0xff
   0325 21rEAr02            733 	ld	hl, #_THIS_IDX
   0328 77                  734 	ld	(hl), a
   0329                     735 00105$:
   0329 21rEAr02            736 	ld	hl, #_THIS_IDX
   032C 4E                  737 	ld	c, (hl)
   032D 0C                  738 	inc	c
   032E 79                  739 	ld	a, c
   032F B7                  740 	or	a, a
   0330 CArD0r03            741 	jp	Z, 00103$
                            742 ;C:/GB/ZGB/common/src/SpriteManager.c:104: THIS = sprite_manager_sprites[sprite_manager_updatables[THIS_IDX + 1u]];
   0333 59                  743 	ld	e, c
   0334 16 00               744 	ld	d, #0x00
   0336 21rD2r02            745 	ld	hl, #_sprite_manager_updatables
   0339 19                  746 	add	hl, de
   033A 33                  747 	inc	sp
   033B 33                  748 	inc	sp
   033C E5                  749 	push	hl
   033D D1                  750 	pop	de
   033E D5                  751 	push	de
   033F 1A                  752 	ld	a,(de)
   0340 4F                  753 	ld	c, a
   0341 06 00               754 	ld	b, #0x00
   0343 CB 21               755 	sla	c
   0345 CB 10               756 	rl	b
   0347 21r94r02            757 	ld	hl, #_sprite_manager_sprites
   034A 09                  758 	add	hl, bc
   034B 4D                  759 	ld	c, l
   034C 44                  760 	ld	b, h
   034D 59                  761 	ld	e, c
   034E 50                  762 	ld	d, b
   034F 1A                  763 	ld	a,(de)
   0350 21rEBr02            764 	ld	hl, #_THIS
   0353 22                  765 	ld	(hl+), a
   0354 13                  766 	inc	de
   0355 1A                  767 	ld	a, (de)
                            768 ;C:/GB/ZGB/common/src/SpriteManager.c:105: if(THIS->marked_for_removal) {
   0356 32                  769 	ld	(hl-), a
   0357 4E                  770 	ld	c, (hl)
   0358 23                  771 	inc	hl
   0359 46                  772 	ld	b, (hl)
   035A 21 12 00            773 	ld	hl, #0x0012
   035D 09                  774 	add	hl, bc
   035E 4D                  775 	ld	c, l
   035F 44                  776 	ld	b, h
   0360 0A                  777 	ld	a, (bc)
   0361 B7                  778 	or	a, a
   0362 CArC9r03            779 	jp	Z, 00106$
                            780 ;C:/GB/ZGB/common/src/SpriteManager.c:106: StackPush(sprite_manager_sprites_pool, sprite_manager_updatables[THIS_IDX + 1u]);
   0365 21rD0r02            781 	ld	hl, #_sprite_manager_sprites_pool
   0368 34                  782 	inc	(hl)
   0369 20 02               783 	jr	NZ,00126$
   036B 23                  784 	inc	hl
   036C 34                  785 	inc	(hl)
   036D                     786 00126$:
   036D 21rD1r02            787 	ld	hl, #_sprite_manager_sprites_pool + 1
   0370 2B                  788 	dec	hl
   0371 4E                  789 	ld	c, (hl)
   0372 23                  790 	inc	hl
   0373 46                  791 	ld	b, (hl)
   0374 D1                  792 	pop	de
   0375 D5                  793 	push	de
   0376 1A                  794 	ld	a,(de)
   0377 02                  795 	ld	(bc), a
                            796 ;C:/GB/ZGB/common/src/SpriteManager.c:107: VectorRemovePos(sprite_manager_updatables, THIS_IDX);
   0378 21rEAr02            797 	ld	hl, #_THIS_IDX
   037B 7E                  798 	ld	a, (hl)
   037C F5                  799 	push	af
   037D 33                  800 	inc	sp
   037E 21rD2r02            801 	ld	hl, #_sprite_manager_updatables
   0381 E5                  802 	push	hl
   0382 CDr00r00            803 	call	_VectorRemovePos
   0385 E8 03               804 	add	sp, #3
                            805 ;C:/GB/ZGB/common/src/SpriteManager.c:109: PUSH_BANK(spriteBanks[THIS->type]);
   0387 21rECr02            806 	ld	hl, #_THIS + 1
   038A 2B                  807 	dec	hl
   038B 4E                  808 	ld	c, (hl)
   038C 23                  809 	inc	hl
   038D 46                  810 	ld	b, (hl)
   038E 21 11 00            811 	ld	hl, #0x0011
   0391 09                  812 	add	hl, bc
   0392 4D                  813 	ld	c, l
   0393 44                  814 	ld	b, h
   0394 0A                  815 	ld	a, (bc)
   0395 C6r00               816 	add	a, #<(_spriteBanks)
   0397 4F                  817 	ld	c, a
   0398 3E 00               818 	ld	a, #0x00
   039A CEs00               819 	adc	a, #>(_spriteBanks)
   039C 47                  820 	ld	b, a
   039D 0A                  821 	ld	a, (bc)
   039E F5                  822 	push	af
   039F 33                  823 	inc	sp
   03A0 CDr00r00            824 	call	_PushBank
   03A3 33                  825 	inc	sp
                            826 ;C:/GB/ZGB/common/src/SpriteManager.c:110: spriteDestroyFuncs[THIS->type]();
   03A4 21rECr02            827 	ld	hl, #_THIS + 1
   03A7 2B                  828 	dec	hl
   03A8 4E                  829 	ld	c, (hl)
   03A9 23                  830 	inc	hl
   03AA 46                  831 	ld	b, (hl)
   03AB 21 11 00            832 	ld	hl, #0x0011
   03AE 09                  833 	add	hl, bc
   03AF 4D                  834 	ld	c,l
   03B0 7C                  835 	ld	a,h
   03B1 4E                  836 	ld	c, (hl)
   03B2 06 00               837 	ld	b, #0x00
   03B4 CB 21               838 	sla	c
   03B6 CB 10               839 	rl	b
   03B8 21r00r00            840 	ld	hl, #_spriteDestroyFuncs
   03BB 09                  841 	add	hl, bc
   03BC 4D                  842 	ld	c,l
   03BD 44                  843 	ld	b,h
   03BE 4E                  844 	ld	c, (hl)
   03BF 23                  845 	inc	hl
   03C0 46                  846 	ld	b, (hl)
   03C1 69                  847 	ld	l, c
   03C2 60                  848 	ld	h, b
   03C3 CDr00r00            849 	call	___sdcc_call_hl
                            850 ;C:/GB/ZGB/common/src/SpriteManager.c:111: POP_BANK;
   03C6 CDr00r00            851 	call	_PopBank
   03C9                     852 00106$:
                            853 ;C:/GB/ZGB/common/src/SpriteManager.c:103: for(THIS_IDX = sprite_manager_updatables[0] - 1u; (UINT8)(THIS_IDX + 1u) != 0u; THIS_IDX --) {
   03C9 21rEAr02            854 	ld	hl, #_THIS_IDX
   03CC 35                  855 	dec	(hl)
   03CD C3r29r03            856 	jp	00105$
   03D0                     857 00103$:
                            858 ;C:/GB/ZGB/common/src/SpriteManager.c:114: sprite_manager_removal_check = 0;
   03D0 21rE7r02            859 	ld	hl, #_sprite_manager_removal_check
   03D3 36 00               860 	ld	(hl), #0x00
                            861 ;C:/GB/ZGB/common/src/SpriteManager.c:115: }
   03D5 E8 02               862 	add	sp, #2
   03D7 C9                  863 	ret
                            864 ;C:/GB/ZGB/common/src/SpriteManager.c:117: void SetBank(UINT8 bank)
                            865 ;	---------------------------------
                            866 ; Function SetBank
                            867 ; ---------------------------------
   03D8                     868 _SetBank::
                            869 ;C:/GB/ZGB/common/src/SpriteManager.c:127: __endasm;
   03D8 F8 02               870 	ldhl	sp, #2
   03DA 7E                  871 	ld	a, (hl)
   03DB EAr00r00            872 	ld	(#__current_bank), a
   03DE EA 00 20            873 	ld	(#0x2000), a
                            874 ;C:/GB/ZGB/common/src/SpriteManager.c:128: }
   03E1 C9                  875 	ret
                            876 ;C:/GB/ZGB/common/src/SpriteManager.c:135: void SpriteManagerUpdate() {
                            877 ;	---------------------------------
                            878 ; Function SpriteManagerUpdate
                            879 ; ---------------------------------
   03E2                     880 _SpriteManagerUpdate::
   03E2 E8 FE               881 	add	sp, #-2
                            882 ;C:/GB/ZGB/common/src/SpriteManager.c:136: SPRITEMANAGER_ITERATE(THIS_IDX, THIS) {
   03E4 21rEAr02            883 	ld	hl, #_THIS_IDX
   03E7 36 00               884 	ld	(hl), #0x00
   03E9 FArD3r02            885 	ld	a, (#(_sprite_manager_updatables + 0x0001) + 0)
   03EC 4F                  886 	ld	c, a
   03ED 06 00               887 	ld	b, #0x00
   03EF CB 21               888 	sla	c
   03F1 CB 10               889 	rl	b
   03F3 21r94r02            890 	ld	hl, #_sprite_manager_sprites
   03F6 09                  891 	add	hl, bc
   03F7 4D                  892 	ld	c, l
   03F8 44                  893 	ld	b, h
   03F9 59                  894 	ld	e, c
   03FA 50                  895 	ld	d, b
   03FB 1A                  896 	ld	a,(de)
   03FC 21rEBr02            897 	ld	hl, #_THIS
   03FF 22                  898 	ld	(hl+), a
   0400 13                  899 	inc	de
   0401 1A                  900 	ld	a, (de)
   0402 77                  901 	ld	(hl), a
   0403                     902 00109$:
   0403 21rD2r02            903 	ld	hl, #_sprite_manager_updatables + 0
   0406 4E                  904 	ld	c, (hl)
   0407 21rEAr02            905 	ld	hl, #_THIS_IDX
   040A 7E                  906 	ld	a, (hl)
   040B 91                  907 	sub	a, c
   040C CArA4r04            908 	jp	Z,00105$
                            909 ;C:/GB/ZGB/common/src/SpriteManager.c:137: if(!THIS->marked_for_removal) {
   040F 21rEBr02            910 	ld	hl, #_THIS
   0412 2A                  911 	ld	a, (hl+)
   0413 5E                  912 	ld	e, (hl)
   0414 F8 00               913 	ldhl	sp,	#0
   0416 22                  914 	ld	(hl+), a
   0417 73                  915 	ld	(hl), e
   0418 D1                  916 	pop	de
   0419 D5                  917 	push	de
   041A 21 12 00            918 	ld	hl, #0x0012
   041D 19                  919 	add	hl, de
   041E 4D                  920 	ld	c,l
   041F 7C                  921 	ld	a,h
   0420 4E                  922 	ld	c, (hl)
   0421 79                  923 	ld	a, c
   0422 B7                  924 	or	a, a
   0423 C2r7Br04            925 	jp	NZ, 00110$
                            926 ;C:/GB/ZGB/common/src/SpriteManager.c:139: SetBank(spriteBanks[THIS->type]);
   0426 D1                  927 	pop	de
   0427 D5                  928 	push	de
   0428 21 11 00            929 	ld	hl, #0x0011
   042B 19                  930 	add	hl, de
   042C 4D                  931 	ld	c, l
   042D 44                  932 	ld	b, h
   042E 0A                  933 	ld	a, (bc)
   042F C6r00               934 	add	a, #<(_spriteBanks)
   0431 4F                  935 	ld	c, a
   0432 3E 00               936 	ld	a, #0x00
   0434 CEs00               937 	adc	a, #>(_spriteBanks)
   0436 47                  938 	ld	b, a
   0437 0A                  939 	ld	a, (bc)
   0438 F5                  940 	push	af
   0439 33                  941 	inc	sp
   043A CDrD8r03            942 	call	_SetBank
   043D 33                  943 	inc	sp
                            944 ;C:/GB/ZGB/common/src/SpriteManager.c:141: spriteUpdateFuncs[THIS->type]();
   043E 21rECr02            945 	ld	hl, #_THIS + 1
   0441 2B                  946 	dec	hl
   0442 4E                  947 	ld	c, (hl)
   0443 23                  948 	inc	hl
   0444 46                  949 	ld	b, (hl)
   0445 21 11 00            950 	ld	hl, #0x0011
   0448 09                  951 	add	hl, bc
   0449 4D                  952 	ld	c, l
   044A 44                  953 	ld	b, h
   044B 0A                  954 	ld	a, (bc)
   044C 4F                  955 	ld	c, a
   044D 06 00               956 	ld	b, #0x00
   044F CB 21               957 	sla	c
   0451 CB 10               958 	rl	b
   0453 21r00r00            959 	ld	hl, #_spriteUpdateFuncs
   0456 09                  960 	add	hl, bc
   0457 4D                  961 	ld	c,l
   0458 44                  962 	ld	b,h
   0459 4E                  963 	ld	c, (hl)
   045A 23                  964 	inc	hl
   045B 46                  965 	ld	b, (hl)
   045C 69                  966 	ld	l, c
   045D 60                  967 	ld	h, b
   045E CDr00r00            968 	call	___sdcc_call_hl
                            969 ;C:/GB/ZGB/common/src/SpriteManager.c:143: if(THIS == scroll_target)
   0461 21rEBr02            970 	ld	hl, #_THIS
   0464 7E                  971 	ld	a, (hl)
   0465 21r00r00            972 	ld	hl, #_scroll_target
   0468 96                  973 	sub	a, (hl)
   0469 20 0D               974 	jr	NZ,00102$
   046B 21rECr02            975 	ld	hl, #_THIS + 1
   046E 7E                  976 	ld	a, (hl)
   046F 21r01r00            977 	ld	hl, #_scroll_target + 1
   0472 96                  978 	sub	a, (hl)
   0473 20 03               979 	jr	NZ,00102$
                            980 ;C:/GB/ZGB/common/src/SpriteManager.c:144: RefreshScroll();
   0475 CDr00r00            981 	call	_RefreshScroll
   0478                     982 00102$:
                            983 ;C:/GB/ZGB/common/src/SpriteManager.c:146: DrawSprite(); //this needs to be done using the sprite bank because the animation array is stored there
   0478 CDr00r00            984 	call	_DrawSprite
   047B                     985 00110$:
                            986 ;C:/GB/ZGB/common/src/SpriteManager.c:136: SPRITEMANAGER_ITERATE(THIS_IDX, THIS) {
   047B 21rEAr02            987 	ld	hl, #_THIS_IDX
   047E 34                  988 	inc	(hl)
   047F 7E                  989 	ld	a, (hl)
   0480 3C                  990 	inc	a
   0481 C6rD2               991 	add	a, #<(_sprite_manager_updatables)
   0483 4F                  992 	ld	c, a
   0484 3E 00               993 	ld	a, #0x00
   0486 CEs02               994 	adc	a, #>(_sprite_manager_updatables)
   0488 69                  995 	ld	l, c
   0489 67                  996 	ld	h, a
   048A 4E                  997 	ld	c, (hl)
   048B 06 00               998 	ld	b, #0x00
   048D CB 21               999 	sla	c
   048F CB 10              1000 	rl	b
   0491 21r94r02           1001 	ld	hl, #_sprite_manager_sprites
   0494 09                 1002 	add	hl, bc
   0495 4D                 1003 	ld	c, l
   0496 44                 1004 	ld	b, h
   0497 59                 1005 	ld	e, c
   0498 50                 1006 	ld	d, b
   0499 1A                 1007 	ld	a,(de)
   049A 21rEBr02           1008 	ld	hl, #_THIS
   049D 22                 1009 	ld	(hl+), a
   049E 13                 1010 	inc	de
   049F 1A                 1011 	ld	a, (de)
   04A0 77                 1012 	ld	(hl), a
   04A1 C3r03r04           1013 	jp	00109$
   04A4                    1014 00105$:
                           1015 ;C:/GB/ZGB/common/src/SpriteManager.c:150: SwapOAMs();
   04A4 CDr00r00           1016 	call	_SwapOAMs
                           1017 ;C:/GB/ZGB/common/src/SpriteManager.c:152: if(sprite_manager_removal_check) {
   04A7 21rE7r02           1018 	ld	hl, #_sprite_manager_removal_check
   04AA 7E                 1019 	ld	a, (hl)
   04AB B7                 1020 	or	a, a
   04AC 28 03              1021 	jr	Z,00111$
                           1022 ;C:/GB/ZGB/common/src/SpriteManager.c:153: SpriteManagerFlushRemove();
   04AE CDr1Er03           1023 	call	_SpriteManagerFlushRemove
   04B1                    1024 00111$:
                           1025 ;C:/GB/ZGB/common/src/SpriteManager.c:155: }
   04B1 E8 02              1026 	add	sp, #2
   04B3 C9                 1027 	ret
                           1028 	.area _CODE
                           1029 	.area _CABS (ABS)
